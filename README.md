# Bomb Defusal Multi-Agent Benchmark

This repository implements a cooperative bomb defusal environment with two complementary multi-agent baselines:

- **MAPPO baseline** – a centralized-critic PPO variant trained directly against the environment.
- **LLM baseline** – an agentic controller that queries the DeepSeek API with hierarchical Theory of Mind (ToM) prompts.

The environment models three agents (Alpha, Bravo, Charlie) that must coordinate to inspect and defuse colour-coded bombs. Each bomb requires a deterministic sequence of coloured wire cuts, and agents are geographically constrained by a network of rooms.

## Dependencies

Install the required Python packages before running the baselines:

```bash
pip install fastapi uvicorn httpx numpy torch
```

## Project layout

```
bomb_game/
  api.py            # FastAPI surface for interactive play/testing
  env.py            # Gym-style environment wrapper used by MAPPO
  game.py           # Core environment logic and state transitions
  llm_agents.py     # DeepSeek-powered multi-agent controller
  mappo.py          # MAPPO implementation with shared actor-critic
  tommind.py        # Three-level ToM probe generation utilities
scripts/
  train_mappo.py    # CLI for training the MAPPO baseline
  run_llm_agents.py # CLI for sampling DeepSeek ToM responses
```

## MAPPO baseline

The `MAPPOTrainer` class implements a minimal multi-agent PPO with Generalised Advantage Estimation. To collect data and update the policy run:

```bash
python scripts/train_mappo.py --episodes 25 --rollout-length 64
```

The script prints per-episode losses and persists them to `mappo_metrics.json` for downstream analysis.

## LLM ToM baseline

To explore the DeepSeek-powered reasoning baseline, export your API key and run the helper script:

```bash
export DEEPSEEK_API_KEY="sk-..."
python scripts/run_llm_agents.py
```

For each agent the controller produces JSON-formatted responses that include:

- **Introspection** – articulation of its own knowledge (self-awareness).
- **First-order ToM** – beliefs about other agents' knowledge of bombs.
- **Second-order ToM** – beliefs about what other agents think _it_ knows, inferred via shared observations and action history.

The prompts are grounded in the live game state generated by `bomb_game.game` and remain compatible with the FastAPI service defined in `bomb_game.api`.

## FastAPI service

Launch the HTTP interface with:

```bash
uvicorn bomb_game.api:app --reload
```

This exposes REST endpoints for starting games, fetching state, and submitting batched actions per round.

## Testing

No automated tests are bundled; use the training and LLM scripts as smoke tests to validate the environment and baseline integrations.
